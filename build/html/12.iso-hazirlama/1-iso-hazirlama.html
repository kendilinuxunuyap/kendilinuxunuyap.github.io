
<!DOCTYPE html>

<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>İso Hazırlama &#8212; distro Wiki  belgelendirmesi</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="canonical" href="https://kendilinuxunuyap.github.io/12.iso-hazirlama/1-iso-hazirlama.html" />
    <link rel="index" title="Dizin" href="../genindex.html" />
    <link rel="search" title="Ara" href="../search.html" />
    <link rel="next" title="bps ile İso Yapma" href="2-bps-iso-yapma.html" />
    <link rel="prev" title="iso Hazırlama" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="iso-hazirlama">
<h1>İso Hazırlama<a class="headerlink" href="#iso-hazirlama" title="Permalink to this heading">¶</a></h1>
<p>Önceki bölümlerde paketler derlendi. Bu paketler oturum açtığınız kullanıcı ev dizinde <strong>$HOME/distro/rootfs</strong> konumunda olacaktır. Burada <strong>$HOME</strong> açık olan kullanıcı neyse onun konumunu verecektir. Örneğin kullanıcı adımız <strong>bd</strong> olsun. Bu durumda <strong>$HOME</strong> değeri <strong>/home/bd/</strong> olacaktır. Bu örneğimize göre <strong>$HOME/distro/rootfs</strong> ifadesi aslında <strong>/home/bd/distro/rootfs</strong> dir.</p>
<p>İso hazırlama işlemini yazımızın başında minimal iso yapma anlatılmıştı. Burada da benzer yol izlenecek. Sistemimin yani oluşacak <strong>iso</strong> dosyasının yapısı aşağıdaki gibi olacaktır. Buradaki dört dsyanunda nasıl hazırlanacağı ayrı ayrı anlatılacak ve en son hepsini kapsayan iso yapma scriptimizi vereceğiz.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nv">$HOME</span>/distro/iso/boot/initrd.img
<span class="nv">$HOME</span>/distro/iso/boot/vmlinuz
<span class="nv">$HOME</span>/distro/iso/live/filesystem.squashfs
</pre></div>
</div>
<section id="grub-cfg-hazirlama">
<h2><strong>grub.cfg Hazırlama</strong><a class="headerlink" href="#grub-cfg-hazirlama" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>Sistemin açılmasını sağlayan dosyalardan birisi <strong>grub.cfg</strong> dosyasıdır. Genel olarak grub.cfg dosyası aşağıdaki gibi olmalıdır.</p>
</div></blockquote>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">       </span>linux<span class="w"> </span>/boot/vmlinuz
<span class="w">       </span>initrd<span class="w"> </span>/boot/initrd.img
<span class="w">       </span>boot


Bu<span class="w"> </span>sistem<span class="w"> </span>için<span class="w"> </span>grub.cfg<span class="w"> </span>dosyası<span class="w"> </span>aşağıdaki<span class="w"> </span>gibi<span class="w"> </span>düzenlendi.<span class="w"> </span>Burada<span class="w"> </span>dikkat<span class="w"> </span>edilmesi<span class="w"> </span>gereken<span class="w"> </span>menü<span class="w"> </span>seçeneklerinde<span class="w"> </span>**live**<span class="w"> </span>ifadesi<span class="w"> </span>kulllanılması.<span class="w"> </span>Ayrıca<span class="w"> </span>sistemimizin<span class="w"> </span>servis<span class="w"> </span>yönetici<span class="w"> </span>ile<span class="w"> </span>başlatılmasını<span class="w"> </span>istediğimiz<span class="w"> </span>için<span class="w"> </span>**linux<span class="w"> </span>/boot/vmlinuz<span class="w"> </span><span class="nv">boot</span><span class="o">=</span>live<span class="w"> </span><span class="nv">init</span><span class="o">=</span>/sbin/openrc-init<span class="w"> </span>net.ifnames<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">biosdevname</span><span class="o">=</span><span class="m">0</span>**<span class="w"> </span>sistemi<span class="w"> </span>canlı<span class="w"> </span>açılmasını<span class="w"> </span>sağlıyor.
Kurulum<span class="w"> </span>için<span class="w"> </span>ise<span class="w"> </span>canlı<span class="o">(</span>**live**<span class="o">)</span><span class="w"> </span>açıp<span class="w"> </span>kurulum<span class="w"> </span>yapmasını<span class="w"> </span>sağlayan<span class="w"> </span>satırımız<span class="w"> </span>**linux<span class="w"> </span>/boot/vmlinuz<span class="w"> </span><span class="nv">boot</span><span class="o">=</span>live<span class="w"> </span><span class="nv">init</span><span class="o">=</span>/bin/kur<span class="w"> </span>quiet**<span class="w"> </span>dır.
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Write grub.cfg</span>
<span class="c1"># Timeout for menu</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set timeout=3\n&quot;</span>&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg

<span class="c1"># Default boot entry</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set default=1\n&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg

<span class="c1"># Menu Colours</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set menu_color_normal=white/black\n&quot;</span>&gt;&gt;<span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set menu_color_highlight=white\/blue\n&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;insmod all_video&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;terminal_output console&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;terminal_input console&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg

<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;menuentry &quot;Canli(live) GNU/Linux 64-bit&quot; --class liveiso  {&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    linux /boot/vmlinuz boot=live init=/sbin/openrc-init net.ifnames=0 biosdevname=0&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    initrd /boot/initrd.img&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg

<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;menuentry &quot;Kur GNU/Linux 64-bit&quot; --class liveiso  {&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    linux /boot/vmlinuz boot=live init=/bin/kur quiet&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    initrd /boot/initrd.img&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/boot/grub/grub.cfg
</pre></div>
</div>
</section>
<section id="initrd-img-hazirlanmasi">
<h2><strong>initrd.img Hazırlanması</strong><a class="headerlink" href="#initrd-img-hazirlanmasi" title="Permalink to this heading">¶</a></h2>
</section>
<section id="initrd-olusturma-guncelleme">
<h2><strong>initrd Oluşturma/Güncelleme</strong><a class="headerlink" href="#initrd-olusturma-guncelleme" title="Permalink to this heading">¶</a></h2>
<p>Sistemin initrd.img dosyasının güncellenmesi/oluşturulması için çalıştığınız sistemde  aşağıdaki komutlarla yapılabilir.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/usr/sbin/update-initramfs<span class="w"> </span>-u<span class="w"> </span>-k<span class="w"> </span><span class="k">$(</span>uname<span class="w"> </span>-r<span class="k">)</span><span class="w"> </span><span class="c1">#initrd günceller</span>
</pre></div>
</div>
<p>Eğer bir dizin içinde bir sisteme initrd oluşturlacaksa, yani chroot ile sisteme erişiliyorsa yukarıdaki komut yeterli olmayacaktır. chroot öncesinde sistemin <strong>dev sys proc run</strong> dizinlerinin  bağlanılması gerekmektedir. Dizindeki sistemimizin dizin konumu <strong>/$HOME/distro/rootfs</strong> olsun. Buna göre aşağıda sisteme yukarıdaki komutu çalıştırmadan önce çalıştırılması gereken komutlar aşağıda verilmiştir. Dikkat edilmesi gereken en önemli noktalardan biriside bu komutlar <strong>root</strong> yetkisiyle çalıştırılmalıdır.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">## ---------------------------------------------                initrd.img oluşturma scripti             ---------------------------------------------</span>
<span class="nv">rootfs</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/distro/rootfs&quot;</span>
<span class="nv">distro</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/distro&quot;</span>
<span class="c1">## Dizinler Oluşturuluyor</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$rootfs</span>/dev
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$rootfs</span>/sys
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$rootfs</span>/proc
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$rootfs</span>/run
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$rootfs</span>/tmp
<span class="c1">## Dizinler bağlanıyor</span>
mount<span class="w"> </span>--bind<span class="w"> </span>/dev<span class="w"> </span><span class="nv">$rootfs</span>/dev
mount<span class="w"> </span>--bind<span class="w"> </span>/sys<span class="w"> </span><span class="nv">$rootfs</span>/sys
mount<span class="w"> </span>--bind<span class="w"> </span>/proc<span class="w"> </span><span class="nv">$rootfs</span>/proc
mount<span class="w"> </span>--bind<span class="w"> </span>/run<span class="nv">$rootfs</span>/run
mount<span class="w"> </span>--bind<span class="w"> </span>/tmp<span class="w"> </span><span class="nv">$rootfs</span>/tmp

<span class="c1">### initrd.img oluşturuluyor/güncelleniyor</span>
<span class="nv">fname</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$rootfs</span>/boot/config*<span class="k">)</span>
<span class="nv">kversion</span><span class="o">=</span><span class="si">${</span><span class="nv">fname</span><span class="p">:</span><span class="nv">7</span><span class="si">}</span>
mv<span class="w"> </span><span class="nv">$rootfs</span>/boot/config*<span class="w"> </span><span class="nv">$rootfs</span>/boot/config-<span class="nv">$kversion</span>
cp<span class="w"> </span><span class="nv">$rootfs</span>/boot/config-<span class="nv">$kversion</span><span class="w"> </span><span class="nv">$rootfs</span>/etc/kernel-config
chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span>update-initramfs<span class="w"> </span>-u<span class="w"> </span>-k<span class="w"> </span><span class="nv">$kversion</span>

<span class="c1">## Dizin bağlantıları kaldırılıyor</span>
umount<span class="w"> </span>-lf<span class="w"> </span>-R<span class="w"> </span><span class="nv">$rootfs</span>/dev<span class="w"> </span><span class="m">2</span>&gt;/dev/null
umount<span class="w"> </span>-lf<span class="w"> </span>-R<span class="w"> </span><span class="nv">$rootfs</span>/sys<span class="w"> </span><span class="m">2</span>&gt;/dev/null
umount<span class="w"> </span>-lf<span class="w"> </span>-R<span class="w"> </span><span class="nv">$rootfs</span>/proc<span class="w"> </span><span class="m">2</span>&gt;/dev/null
umount<span class="w"> </span>-lf<span class="w"> </span>-R<span class="w"> </span><span class="nv">$rootfs</span>/run<span class="w"> </span><span class="m">2</span>&gt;/dev/null
umount<span class="w"> </span>-lf<span class="w"> </span>-R<span class="w"> </span><span class="nv">$rootfs</span>/tmp<span class="w"> </span><span class="m">2</span>&gt;/dev/null
<span class="c1">#### initrd kopyalanıyor</span>
cp<span class="w"> </span>-pf<span class="w"> </span><span class="nv">$rootfs</span>/boot/initrd.img-*<span class="w"> </span><span class="nv">$distro</span>/iso/boot/initrd.img
</pre></div>
</div>
</section>
<section id="vmlinuz-hazirlanmasi">
<h2><strong>vmlinuz Hazırlanması</strong><a class="headerlink" href="#vmlinuz-hazirlanmasi" title="Permalink to this heading">¶</a></h2>
<p>Kernelimizi iso dizinimize taşıyoruz.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">rootfs</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/distro/rootfs&quot;</span>
<span class="nv">distro</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/distro&quot;</span>
<span class="c1">#### Copy kernel</span>
cp<span class="w"> </span>-pf<span class="w"> </span><span class="nv">$rootfs</span>/boot/vmlinuz-*<span class="w"> </span><span class="nv">$distro</span>/iso/boot/vmlinuz
<span class="c1">#rm -rf $rootfs/boot #istenir boyut küçültmek için bu komut aktifleştirilebilir.</span>
</pre></div>
</div>
</section>
<section id="filesystem-squashfs-hazirlama">
<h2><strong>filesystem.squashfs Hazırlama</strong><a class="headerlink" href="#filesystem-squashfs-hazirlama" title="Permalink to this heading">¶</a></h2>
<p>Sistemi <strong>live</strong> kullanma ve yükleme yapabilmek için yapılan sistemi <strong>squashfs</strong> dosya sıkıştırma yöntemiyle sıkılştırıyoruz. Bu dosyayı <strong>$HOME/distro/iso/live/filesystem.squashfs</strong> konumunda olmalı. Aşağıdaki komutlar dosyayı oluşturup <strong>$HOME/distro//iso/live/filesystem.squashfs</strong> konumuna taşımaktadır.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/distro/
mksquashfs<span class="w"> </span><span class="nv">$HOME</span>/distro/rootfs<span class="w"> </span><span class="nv">$HOME</span>/distro/filesystem.squashfs<span class="w"> </span>-comp<span class="w"> </span>xz<span class="w"> </span>-wildcards
mv<span class="w"> </span><span class="nv">$HOME</span>/distro/filesystem.squashfs<span class="w"> </span><span class="nv">$HOME</span>/distro/iso/live/filesystem.squashfs
</pre></div>
</div>
</section>
<section id="iso-dosyasinin-olusturulmasi">
<h2><strong>İso Dosyasının Oluşturulması</strong><a class="headerlink" href="#iso-dosyasinin-olusturulmasi" title="Permalink to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/distro
grub-mkrescue<span class="w"> </span>iso/<span class="w"> </span>-o<span class="w"> </span>distro.iso<span class="w"> </span><span class="c1">#iso doyamız oluşturulur.</span>
</pre></div>
</div>
</section>
<section id="isonun-test-edilmesi">
<h2><strong>İsonun Test Edilmesi</strong><a class="headerlink" href="#isonun-test-edilmesi" title="Permalink to this heading">¶</a></h2>
<p>isolarımız qemu veya virtualbox ile test edilebilir. Linux ortamında terminalden qemu kullanarak aşıdaki gibi test edebilirsiniz. Sistemde qemu paketinin kurulu olması gerekir.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>**qemu-system-x86_64<span class="w"> </span>-cdrom<span class="w"> </span><span class="nv">$HOME</span>/distro/distro.iso<span class="w"> </span>-m<span class="w"> </span>1G**<span class="w"> </span><span class="c1">#komutuyla çalıştırıp test edebiliriz.</span>
</pre></div>
</div>
</section>
<section id="iso-olusturma-scripti">
<h2>iso Oluşturma Scripti<a class="headerlink" href="#iso-olusturma-scripti" title="Permalink to this heading">¶</a></h2>
<p>Sisteme giriş yaptığımız kullanıcının ev dizinindeki <strong>distro/rootfs</strong> disininden <strong>distro/iso</strong> dizinini kullanarak <strong>distro</strong> dizinine <strong>distro.iso</strong> dosyasını oluşturan scriptimiz aşağıdadır.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">display</span><span class="o">=</span><span class="s2">&quot;:</span><span class="k">$(</span>ls<span class="w"> </span>/tmp/.X11-unix/*<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s#/tmp/.X11-unix/X##&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span><span class="s2">&quot;</span><span class="w">      </span><span class="c1">#Detect the name of the display in use</span>
<span class="nv">user</span><span class="o">=</span><span class="k">$(</span>who<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;(&#39;</span><span class="nv">$display</span><span class="s1">&#39;)&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span><span class="w">    </span><span class="c1">#Detect the user using such display</span>

<span class="nv">distro</span><span class="o">=</span><span class="s2">&quot;/home/</span><span class="nv">$user</span><span class="s2">/distro&quot;</span>
<span class="nv">rootfs</span><span class="o">=</span><span class="s2">&quot;/home/</span><span class="nv">$user</span><span class="s2">/distro/rootfs&quot;</span>
rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">/iso&quot;</span>
<span class="c1">### system chroot  bind/mount</span>
<span class="k">for</span><span class="w"> </span>dir<span class="w"> </span><span class="k">in</span><span class="w"> </span>dev<span class="w"> </span>dev/pts<span class="w"> </span>proc<span class="w"> </span>sys<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nb">bind</span><span class="w"> </span>/<span class="nv">$dir</span><span class="w"> </span><span class="nv">$rootfs</span>/<span class="nv">$dir</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>

chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;1\n1\n&quot;</span><span class="p">|</span>chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span>passwd<span class="w"> </span>root
chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span>useradd<span class="w"> </span>live<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w">  </span>-d<span class="w"> </span>/home/live
chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;live\nlive\n&quot;</span><span class="p">|</span>chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span>passwd<span class="w"> </span>live

<span class="k">for</span><span class="w"> </span>grp<span class="w"> </span><span class="k">in</span><span class="w"> </span>users<span class="w"> </span>tty<span class="w"> </span>wheel<span class="w"> </span>cdrom<span class="w"> </span>audio<span class="w"> </span>dip<span class="w"> </span>video<span class="w"> </span>plugdev<span class="w"> </span>netdev<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span>chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span><span class="nv">$grp</span><span class="w"> </span>live<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
<span class="k">done</span>

sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;/agetty_options/d&quot;</span><span class="w"> </span><span class="nv">$rootfs</span>/etc/conf.d/agetty
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\nagetty_options=\&quot;-l /usr/bin/login\&quot;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$rootfs</span>/etc/conf.d/agetty


<span class="c1">### update-initrd</span>
<span class="nv">fname</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$rootfs</span>/boot/config*<span class="k">)</span>
<span class="nv">kversion</span><span class="o">=</span><span class="si">${</span><span class="nv">fname</span><span class="p">:</span><span class="nv">7</span><span class="si">}</span>
mv<span class="w"> </span><span class="nv">$rootfs</span>/boot/config*<span class="w"> </span><span class="nv">$rootfs</span>/boot/config-<span class="nv">$kversion</span>
cp<span class="w"> </span><span class="nv">$rootfs</span>/boot/config-<span class="nv">$kversion</span><span class="w"> </span><span class="nv">$rootfs</span>/etc/kernel-config

chroot<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span>update-initramfs<span class="w"> </span>-u<span class="w"> </span>-k<span class="w"> </span><span class="nv">$kversion</span>

<span class="c1">#### system chroot umount</span>
<span class="k">for</span><span class="w"> </span>dir<span class="w"> </span><span class="k">in</span><span class="w"> </span>dev<span class="w"> </span>dev/pts<span class="w"> </span>proc<span class="w"> </span>sys<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w">    </span><span class="k">while</span><span class="w"> </span>umount<span class="w"> </span>-lf<span class="w"> </span>-R<span class="w"> </span><span class="nv">$rootfs</span>/<span class="nv">$dir</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="k">done</span>

<span class="c1">#************************iso *********************************</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$distro</span>/iso
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$distro</span>/iso/boot
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$distro</span>/iso/live<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>

<span class="c1">#### Copy initramfs</span>
cp<span class="w"> </span>-pf<span class="w"> </span><span class="nv">$rootfs</span>/boot/initrd.img-*<span class="w"> </span><span class="nv">$distro</span>/iso/boot/initrd.img

<span class="c1">#### Copy kernel</span>
cp<span class="w"> </span>-pf<span class="w"> </span><span class="nv">$rootfs</span>/boot/vmlinuz-*<span class="w"> </span><span class="nv">$distro</span>/iso/boot/vmlinuz
<span class="c1">#rm -rf $rootfs/boot</span>

<span class="c1">#### Create squashfs</span>
mksquashfs<span class="w"> </span><span class="nv">$rootfs</span><span class="w"> </span><span class="nv">$distro</span>/filesystem.squashfs<span class="w"> </span>-comp<span class="w"> </span>xz<span class="w"> </span>-wildcards
mv<span class="w"> </span><span class="nv">$distro</span>/filesystem.squashfs<span class="w"> </span><span class="nv">$distro</span>/iso/live/filesystem.squashfs

<span class="c1">#### Write grub.cfg</span>
<span class="c1"># Timeout for menu</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set timeout=3\n&quot;</span>&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg


<span class="c1"># Default boot entry</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set default=1\n&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg

<span class="c1"># Menu Colours</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set menu_color_normal=white/black\n&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;set menu_color_highlight=white\/blue\n&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;insmod all_video&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;terminal_output console&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;terminal_input console&quot;</span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg

<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;menuentry &quot;Canli(live) GNU/Linux 64-bit&quot; --class liveiso  {&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    linux /boot/vmlinuz boot=live init=/sbin/openrc-init net.ifnames=0 biosdevname=0&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    initrd /boot/initrd.img&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg

<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;menuentry &quot;Kur GNU/Linux 64-bit&quot; --class liveiso  {&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    linux /boot/vmlinuz boot=live init=/bin/kur quiet&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;    initrd /boot/initrd.img&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;}&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$distro</span>/iso/boot/grub/grub.cfg

grub-mkrescue<span class="w"> </span><span class="nv">$distro</span>/iso/<span class="w"> </span>-o<span class="w"> </span><span class="nv">$distro</span>/distro.iso
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.svg" alt="Logo"/>
    
  </a>
</p>








<h3>Gezinti</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../00.kapak/0-kapak.html">KENDİ LİNUX'UNU YAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00.kapak/1-icindekiler.html">İçindekiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.giris/index.html">Temel Kavramlar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03.on-hazirlik/index.html">Ön Hazırlık</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.derleme-araclari/index.html">Derleme Araçları</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09.paket-derleme/index.html">Paket Derleme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11.paket-sistemi/index.html">Paket Sistemi</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">iso Hazırlama</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">İso Hazırlama</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#grub-cfg-hazirlama"><strong>grub.cfg Hazırlama</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#initrd-img-hazirlanmasi"><strong>initrd.img Hazırlanması</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#initrd-olusturma-guncelleme"><strong>initrd Oluşturma/Güncelleme</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#vmlinuz-hazirlanmasi"><strong>vmlinuz Hazırlanması</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#filesystem-squashfs-hazirlama"><strong>filesystem.squashfs Hazırlama</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#iso-dosyasinin-olusturulmasi"><strong>İso Dosyasının Oluşturulması</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#isonun-test-edilmesi"><strong>İsonun Test Edilmesi</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#iso-olusturma-scripti">iso Oluşturma Scripti</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-bps-iso-yapma.html">bps ile İso Yapma</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../13.sistem-kurulumu/index.html">Sistem Kurulumu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../14.X-derleme/index.html">X Pencere Sistemi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../15.yardimci-konular/index.html">Yardımcı Konular</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-about.html">Hakkımda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-contact.html">İletişim</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;distro 2023.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/12.iso-hazirlama/1-iso-hazirlama.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>